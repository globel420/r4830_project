RESUME R4830

1) Latest log file (JSONL):
/Users/globel/r4830_project/swift/logs/ble_events_YYYY-MM-DD_HH-MM-SS.jsonl

2) Latest text log (optional):
/Users/globel/r4830_project/swift/logs/ble_log_YYYY-MM-DD_HH-MM-SS.txt

3) What happened in real world (brief):
- Connected? (yes/no)
- Disconnected? (yes/no, when)
- RX notifications seen? (yes/no)
- Commands tried (list hex)

4) Anything new learned:
- New payloads to add
- Any UI changes requested

LOCKPOINT 2026-02-08 (DO NOT BACKTRACK WITHOUT NEW EVIDENCE)

Latest validated capture:
/Users/globel/r4830_project/controller/captures/raspi_snoop_2026-02-08_11-57-38

Verified command families:
- 0x07 output voltage setpoint
- 0x08 output current setpoint
- 0x0B power-on output toggle
- 0x0C current output path (this firmware: 0=open/on, 1=close/off)
- 0x14 self-stop
- 0x15 power-off current
- 0x20 two-stage switch
- 0x21 two-stage voltage
- 0x22 two-stage current
- 0x23 manual control
- 0x26 soft start time
- 0x27 power limit watts
- 0x2F mode toggle family
- 0x2A language (05-frame family)

Verified ACK pattern:
- RX ACK frames are 0x03: `03 <cmd> 01 <cmd+1/checksum>`
- Examples seen: 03210122, 03220123, 03230124, 03260127, 03270128, 032f0130, 032a012b

Coverage note:
- Latest run may not contain every opposite-state payload.
- Historical captures include:
  - 062f0100000030
  - 052a7a68000c

CHECKPOINT 2026-02-08T20:17:23Z
- Hub Save Tracking added (ACK/NO_ACK/REJECTED/FAILED/UNMAPPED)
- Last unmapped Hub save key fixed:
  - charging_statistics_zero -> 06130000000013
- Current rule for live validation:
  - RX counter increasing + Save Tracking shows ACK = command path is working.

CHECKPOINT 2026-02-08T20:32:00Z
- Web Bluetooth desktop app added:
  - /Users/globel/r4830_project/controller/frontend/index.html
  - /Users/globel/r4830_project/controller/frontend/app.js
  - /Users/globel/r4830_project/controller/frontend/styles.css
- Web app supports mapped controls, ACK-aware save tracking, telemetry summary, keepalive loop.
- Run:
  - cd /Users/globel/r4830_project/controller/frontend
  - python3 -m http.server 8787
  - open http://localhost:8787 in desktop Chrome/Edge

CHECKPOINT 2026-02-08T20:36:00Z
- Web app now includes candidate name/password actions:
  - rename charger -> cmd 0x1E ASCII frame
  - set BLE password -> cmd 0x1B ASCII frame

CHECKPOINT 2026-02-08T20:42:00Z
- Web app language selector expanded to 3 options:
  - English
  - Chinese (Simplified)
  - Chinese (Traditional, candidate)
- Added candidate `0x2A` frame for traditional Chinese:
  - 052a7a740018

CHECKPOINT 2026-02-08T20:50:00Z
- Flutter Hub labels cleaned up to natural English terms.
- Password flow update:
  - current/original password is optional now
  - if provided, auth chunks are sent before password save
- ACK extraction expanded to include len-prefixed name/password frames.
- Flutter language options now include:
  - English
  - Chinese (Simplified)
  - Chinese (Traditional)

CHECKPOINT 2026-02-08T22:05:00Z
- Added execution checklist with estimates:
  - /Users/globel/r4830_project/FUNCTIONAL_FREEZE_CHECKLIST.md
- Checklist has 27 line-by-line items + pass criteria + total timeline.
- OEM use remains fallback-only, especially for password safety validation.

CHECKPOINT 2026-02-08T22:12:00Z
- Split checklist into:
  - Batch A (no wheel / no active charging)
  - Batch B (wheel / active charging)
- Added batch subtotals and execution order to minimize wheel setup time.

CHECKPOINT 2026-02-08T22:28:00Z
- Fixed Power Limit current-value UX bug in Flutter Hub:
  - "current" value now comes from telemetry (not unsaved text field edits).
- Added power-limit extraction from:
  - 6905 bytes 89..90 (LE watts)
  - cmd 0x27 echo

CHECKPOINT 2026-02-08T22:40:00Z
- Added current-limit guardrails in Hub validation:
  - output current >= 0.3A
  - stage 2 current >= 0.3A
  - stage 2 current >= power-off current
  - power-off current <= stage 2 current

CHECKPOINT 2026-02-08T22:55:00Z
- Charge Statistics row now pulls raw counters from telemetry (not placeholders).
- Source mapping:
  - 3006 bytes 40..42 -> stat A (u24 LE)
  - 3006 bytes 43..45 -> stat B (u24 LE)
  - fallback for split 9-byte tail (0000 prefix): bytes 0..2 and 3..5
- UI label now indicates raw values: `Charge Statistics (raw)`.

CHECKPOINT 2026-02-09T23:09:56Z
- Flutter wording cleanup for `0x2F` setting (single-output charger context):
  - "Multi-Motor Control Mode" -> "Current Strategy (Firmware)"
  - options: "Adaptive (Intelligent)" / "Balanced (Equal Distribution)"
- Telemetry card label "Mode" -> "Strategy" with same naming.
- Mapper compatibility kept:
  - `multiMotorMode(...)` still handles legacy strings and new strings.
- UI state sync improvement:
  - strategy and language dropdown values now follow telemetry readback.
- Checklist terminology aligned:
  - `FUNCTIONAL_FREEZE_CHECKLIST.md` step 17 renamed to "Current Strategy Mode (`0x2F`)".

CHECKPOINT 2026-02-09T23:17:52Z
- Fixed output enable readback mismatch in Flutter Hub.
- Decoder changes:
  - `3006` byte 38 and `6905` byte 77 candidate flags now mapped as:
    - 0 => output enabled/open
    - 1 => output disabled/close
  - Source precedence now: `cmd 0x0C` echo > `6905` flag > `3006` flag.
- Hub UI no longer keeps stale local output state once telemetry has a real output-enabled value.
- Added regression coverage to ensure `cmd 0x0C` overrides candidate long-frame flags.

CHECKPOINT 2026-02-09T23:24:13Z
- Hub Output Current Limit input now hydrates from charger telemetry at session start.
- Hydration behavior:
  - source order: `outputSetCurrent` then `outputCurrent`
  - one-time per connection
  - user edits are preserved (startup hydration will not overwrite manual typing)
  - disconnect resets hydration state for next session
- Added widget regression test for connected-start hydration.
